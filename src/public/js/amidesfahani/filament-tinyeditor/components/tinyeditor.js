var m=(b,v,g={})=>{b.getContainer().closest("form")?.dispatchEvent(new CustomEvent(v,{composed:!0,cancelable:!0,detail:g}))};function me({activePanel:b,state:v,statePath:g,selector:F,plugins:U,external_plugins:O,toolbar:$,text_patterns:A,language:_="en",language_url:C=null,directionality:M="ltr",height:I=null,max_height:T=0,min_height:x=100,width:k=null,max_width:z=0,min_width:S=400,resize:L=!1,skin:P="oxide",content_css:D="default",content_style:R="",toolbar_sticky:B=!0,toolbar_sticky_offset:ie=64,toolbar_mode:se="sliding",toolbar_location:ne="auto",fixed_toolbar_container_target:oe=null,inline:re=!1,toolbar_persist:le=!1,menubar:q=!1,font_size_formats:K="",fontfamily:V="",relative_urls:W=!0,image_list:G=null,image_advtab:j=!1,image_description:H=!1,image_class_list:N=null,images_upload_url:J=null,images_upload_base_path:Q=null,remove_script_host:X=!0,convert_urls:Y=!0,custom_configs:Z={},setup:E=null,disabled:ae=!1,locale:de="en",license_key:ee="gpl",placeholder:ce=null,removeImagesEventCallback:c=null,uploadingMessage:he="Uploading image...",key:h}){let f=window.filamentTinyEditors||{};return{activePanel:b,id:null,state:v,statePath:g,selector:F,language:_,language_url:C,directionality:M,height:I,max_height:T,min_height:x,width:k,max_width:z,min_width:S,resize:L,skin:P,content_css:D,content_style:R,plugins:U,external_plugins:O,toolbar:$,text_patterns:A,toolbar_sticky:B,menubar:q,relative_urls:W,remove_script_host:X,convert_urls:Y,font_size_formats:K,fontfamily:V,setup:E,image_list:G,image_advtab:j,image_description:H,image_class_list:N,images_upload_url:J,images_upload_base_path:Q,license_key:ee,custom_configs:Z,updatedAt:Date.now(),disabled:ae,locale:de,placeholder:ce,removeImagesEventCallback:c,isUploadingFile:!1,isModalOpen:!1,init(){this.delete(),(!this.inline||this.isModalOpen)&&this.$nextTick(()=>{this.tryInitializeEditor(this.state||"")}),this.$watch("state",e=>{this.editor()&&(this.isUploadingFile||e!==this.editor().getContent()&&(this.updateEditorContent(e||""),this.putCursorToEnd()))}),window.addEventListener("rich-editor-uploading-file",e=>{e.detail.livewireId===this.$wire.id&&e.detail.key===h&&(this.isUploadingFile=!0,e.stopPropagation())}),window.addEventListener("rich-editor-uploaded-file",e=>{e.detail.livewireId===this.$wire.id&&e.detail.key===h&&(this.isUploadingFile=!1,e.stopPropagation())}),this.$el.closest(".fi-modal")?.addEventListener("open-tinyeditor-modal",()=>{this.isModalOpen=!0,this.$nextTick(()=>this.tryInitializeEditor(this.state||""))}),this.$el.closest(".fi-modal")?.addEventListener("close-tinyeditor-modal",()=>{this.isModalOpen=!1,this.delete()}),this.$watch("isModalOpen",e=>{this.isUploadingFile||(e?this.$nextTick(()=>{this.delete(),this.tryInitializeEditor(this.state||"")}):this.delete())}),this._reinitOnMorph=()=>{this.isUploadingFile||this.$nextTick(()=>{document.querySelector(this.selector)&&!this.editor()&&this.tryInitializeEditor(this.state||"")})},document.addEventListener("livewire:morph",this._reinitOnMorph);let i=this.$el.closest("[wire\\:sortable]")||this.$el.closest(".fi-fo-repeater");i&&(this._repeaterObserver=new MutationObserver(e=>{this.isUploadingFile||this.$nextTick(()=>{document.querySelector(this.selector)&&!this.editor()&&this.tryInitializeEditor(this.state||"")})}),this._repeaterObserver.observe(i,{childList:!0,subtree:!0})),window.addEventListener("livewire:navigated",()=>{this.isModalOpen&&this.$nextTick(()=>this.tryInitializeEditor(this.state||""))}),window.filamentTinyEditors=f},editor(){return tinymce.get(f[this.statePath])},isInsideRepeater(){return this.$el.closest("[wire\\:sortable]")!==null||this.$el.closest(".fi-fo-repeater")!==null||this.$el.closest(".fi-fo-builder")!==null},tryInitializeEditor(i){if(!document.querySelector(this.selector)){console.warn(`TinyMCE target node ${this.selector} not found. Retrying...`),setTimeout(()=>this.tryInitializeEditor(i),100);return}this.initEditor(i)},getFileAttachmentUrl:i=>this.$wire.callSchemaComponentMethod(h,"getUploadedFileAttachmentTemporaryUrl",{attachment:i}),initEditor(i){let e=this,te=V||"Arial=arial,helvetica,sans-serif; Courier New=courier new,courier,monospace; AkrutiKndPadmini=Akpdmi-n",ue=K||"8pt 10pt 12pt 14pt 16pt 18pt 24pt 36pt 48pt",pe={selector:F,language:_,language_url:C,directionality:M,statusbar:!1,promotion:!1,height:I,max_height:T,min_height:x,width:k,max_width:z,min_width:S,resize:L,skin:P,content_css:D,content_style:R,plugins:U,external_plugins:O,toolbar:$,text_patterns:A,toolbar_sticky:this.isInsideRepeater()?!1:B,toolbar_sticky_offset:ie,toolbar_mode:se,toolbar_location:ne,fixed_toolbar_container_target:oe,inline:re,toolbar_persist:le,menubar:q,ui_mode:"split",menu:{file:{title:"File",items:"newdocument restoredraft | preview | export print | deleteallconversations"},edit:{title:"Edit",items:"undo redo | cut copy paste pastetext | selectall | searchreplace"},view:{title:"View",items:"code | visualaid visualchars visualblocks | spellchecker | preview fullscreen | showcomments"},insert:{title:"Insert",items:"image link media addcomment pageembed codesample inserttable | charmap emoticons hr | pagebreak nonbreaking anchor tableofcontents | insertdatetime"},format:{title:"Format",items:"bold italic underline strikethrough superscript subscript codeformat | styles blocks fontfamily fontsize align lineheight | forecolor backcolor | language | removeformat"},tools:{title:"Tools",items:"spellchecker spellcheckerlanguage | a11ycheck code wordcount"},table:{title:"Table",items:"inserttable | cell row column | advtablesort | tableprops deletetable"},help:{title:"Help",items:"help"}},font_size_formats:ue,fontfamily:te,font_family_formats:te,relative_urls:W,remove_script_host:X,convert_urls:Y,image_list:G,image_advtab:j,image_description:H,image_class_list:N,images_upload_url:J,images_upload_base_path:Q,license_key:ee,...Z,setup:function(t){window.tinySettingsCopy||(window.tinySettingsCopy=[]),t.settings&&!window.tinySettingsCopy.some(o=>o.id===t.settings.id)&&window.tinySettingsCopy.push(t.settings),t.on("blur",function(o){e.updatedAt=Date.now(),e.state=t.getContent()}),t.on("change",function(o){e.updatedAt=Date.now(),e.state=t.getContent()}),t.on("init",function(o){f[e.statePath]=t.id,i!=null&&t.setContent(i)}),t.on("OpenWindow",function(o){let l=o.target.container.closest(".fi-modal");l&&l.setAttribute("x-trap.noscroll","false")}),t.on("CloseWindow",function(o){let l=o.target.container.closest(".fi-modal");l&&l.setAttribute("x-trap.noscroll","isOpen")}),typeof E=="function"&&E(t)},removeImagesEventCallback:t=>{this.$wire.callSchemaComponentMethod(h,"deleteUploadedImage",{src:t})},images_upload_handler:(t,o)=>new Promise((l,u)=>{if(!t.blob()){u("No file provided");return}this.isUploadingFile=!0,m(this.editor(),"form-processing-started",{message:he});let p=("10000000-1000-4000-8000"+-1e11).replace(/[018]/g,s=>(s^crypto.getRandomValues(new Uint8Array(1))[0]&15>>s/4).toString(16));this.editor().getContainer().dispatchEvent(new CustomEvent("rich-editor-uploading-file",{bubbles:!0,detail:{key:h,livewireId:this.$wire.id}})),this.$wire.upload(`componentFileAttachments.${g}.${p}`,t.blob(),()=>{this.getFileAttachmentUrl(p).then(s=>{if(!s){u("Image upload failed - no URL returned"),this.isUploadingFile=!1,m(this.editor(),"form-processing-finished");return}this.editor().getContainer().dispatchEvent(new CustomEvent("rich-editor-uploaded-file",{bubbles:!0,detail:{key:h,livewireId:this.$wire.id}})),m(this.editor(),"form-processing-finished"),this.isUploadingFile=!1,l(s);let r=this.editor();r.once("SetContent",({content:w,format:d,paster:n,selection:y})=>{let a=r.getBody().querySelectorAll("img:not([data-id])");a.length>0&&a[a.length-1].setAttribute("data-id",p)})}).catch(s=>{console.error("Upload error:",s),u(s),this.isUploadingFile=!1,m(this.editor(),"form-processing-finished")})},s=>{u("Upload failed: "+s),this.isUploadingFile=!1,m(this.editor(),"form-processing-finished")},s=>{o(s.detail.progress*100)})}),init_instance_callback:function(t){var o=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver,l=c&&typeof c=="function";if(l){var u=new o(function(p,s){var r=[];p.forEach(function(d){Array.from(d.addedNodes).forEach(function(n){if(n.nodeName==="IMG"&&n.className!=="mce-clonedresizable"){if(r.indexOf(n.src)>=0)return;r.push(n.getAttribute("src"));return}var y=n.getElementsByTagName("img");Array.from(y).forEach(function(a){r.indexOf(a.src)>=0||r.push(a.getAttribute("src"))})})});var w=[];p.forEach(function(d){Array.from(d.removedNodes).forEach(function(n){if(n.nodeName==="IMG"&&n.className!=="mce-clonedresizable"){if(w.indexOf(n.src)>=0)return;w.push(n.getAttribute("src"));return}if(n.nodeType===1){var y=n.getElementsByTagName("img");Array.from(y).forEach(function(a){r.indexOf(a.src)>=0||r.push(a.getAttribute("src"))})}})}),w.forEach(function(d){r.indexOf(d)>=0||c&&typeof c=="function"&&c(d)})});u.observe(t.getBody(),{childList:!0,subtree:!0})}},automatic_uploads:!0};tinymce.init(pe)},updateEditorContent(i){this.editor().setContent(i)},putCursorToEnd(){this.editor().selection.select(this.editor().getBody(),!0),this.editor().selection.collapse(!1)},delete(){try{f[this.statePath]&&(this.editor().destroy(),delete f[this.statePath]),this._reinitOnMorph&&document.removeEventListener("livewire:morph",this._reinitOnMorph),this._repeaterObserver&&this._repeaterObserver.disconnect()}catch{console.log(f[this.statePath]),console.log(this.editor())}}}}export{me as default};
